<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - Deposits</title>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#0b0f1a;color:#fff;}
.topbar{position:fixed;top:0;left:0;width:100%;height:60px;background:#111827;display:flex;align-items:center;padding:0 20px;z-index:1001;}
.topbar h1{margin:0;font-size:18px;}
.sidebar{position:fixed;top:60px;left:0;width:260px;height:calc(100vh-60px);background:#111827;padding:15px;overflow-y:auto;}
.sidebar ul{list-style:none;padding:0;margin:0;}
.sidebar li{margin:10px 0;}
.sidebar a{display:block;padding:10px;color:#fff;text-decoration:none;border-radius:6px;}
.sidebar a:hover{background:#38bdf8;color:#000;}
.main{margin-left:260px;margin-top:60px;padding:15px;}
table{width:100%;border-collapse:collapse;margin-top:15px;}
th,td{border:1px solid #38bdf8;padding:8px;text-align:center;}
th{background:#1f2937;}
button{padding:5px 10px;border:none;border-radius:6px;background:#38bdf8;color:#0b0f1a;font-weight:bold;cursor:pointer;margin:2px;}
input{width:60px;padding:3px;border-radius:4px;border:none;text-align:center;}
</style>
</head>
<body>

<div class="topbar"><h1>Admin - Deposits</h1></div>
<div class="sidebar">
<ul>
<li><a href="admin-dashboard.html">Dashboard</a></li>
<li><a href="admin-users.html">Users</a></li>
<li><a href="admin-deposits.html">Deposits</a></li>
<li><a href="admin-withdraws.html">Withdraws</a></li>
<li><a href="admin-nfts.html">NFTs</a></li>
<li><a href="admin-login.html" id="logoutBtn">Logout</a></li>
</ul>
</div>

<div class="main">
<h2>All Deposits</h2>
<table>
<thead>
<tr>
<th>User Email</th>
<th>Amount</th>
<th>Method</th>
<th>Timestamp</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="depositTable"></tbody>
</table>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyB4SGtNZL0N4TIoJ1bGbkiAeRWJcQgrF-4",
authDomain: "supernft-5b952.firebaseapp.com",
projectId: "supernft-5b952",
storageBucket: "supernft-5b952.appspot.com",
messagingSenderId: "278097730700",
appId: "1:278097730700:web:6ba9892334456fd8512fa9"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth, async user=>{
  if(!user) return window.location.replace("admin-login.html");
  const snap = await getDoc(doc(db,"admins",user.uid));
  if(!snap.exists()) return window.location.replace("admin-login.html");
  loadDeposits();
});

document.getElementById("logoutBtn").addEventListener("click",()=>signOut(auth).then(()=>window.location.replace("admin-login.html")));

async function loadDeposits(){
  const usersSnap = await getDocs(collection(db,"users"));
  const tbody = document.getElementById("depositTable");
  tbody.innerHTML="";
  for(const u of usersSnap.docs){
    const data = u.data();
    const email = data.email||u.id;
    (data.deposits||[]).forEach((d,i)=>{
      const tr = document.createElement("tr");
      tr.innerHTML=`
      <td>${email}</td>
      <td>${d.amount}</td>
      <td>${d.method}</td>
      <td>${d.timestamp.toDate().toLocaleString()}</td>
      <td>
        <button onclick="adjustDeposit('${u.id}',${i},${d.amount})">Adjust</button>
      </td>
      `;
      tbody.appendChild(tr);
    });
  }
}

// Adjust deposit
window.adjustDeposit = async (uid,index,currentAmount)=>{
  const newAmt = prompt("Enter new deposit amount",currentAmount);
  if(newAmt===null) return;
  const userRef = doc(db,"users",uid);
  const userSnap = await getDoc(userRef);
  const deposits = userSnap.data().deposits||[];
  deposits[index].amount = Number(newAmt);
  await updateDoc(userRef,{deposits});
  alert("Deposit updated ‚úÖ");
  loadDeposits();
}
</script>
  <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDdTprqsuAaDiDDoK7K6tHAyabfyPs5DTk",
  authDomain: "mysuper-nft.firebaseapp.com",
  projectId: "mysuper-nft",
  storageBucket: "mysuper-nft.firebasestorage.app",
  messagingSenderId: "1061978771986",
  appId: "1:1061978771986:web:ef0302af5bb02c2cd0fecb"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* üîê ADMIN GUARD */
onAuthStateChanged(auth, async (user) => {
  if (!user) {
    location.replace("admin-login.html");
    return;
  }

  const snap = await getDoc(doc(db, "admin", user.uid));
  if (!snap.exists()) {
    alert("Access denied ‚ùå Not Admin");
    await signOut(auth);
    location.replace("admin-login.html");
  }
});
</script>
</body>
</html>
