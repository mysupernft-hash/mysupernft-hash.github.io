<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SuperNFT Admin Dashboard</title>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#0b0f1a;color:#fff;}
.topbar{background:#111827;padding:15px;text-align:center;font-weight:bold;font-size:18px;color:#38bdf8;}
table{width:100%;border-collapse:collapse;margin-top:15px;}
th,td{padding:10px;border:1px solid #38bdf8;text-align:center;}
button{padding:5px 10px;border:none;border-radius:5px;background:#38bdf8;color:#0b0f1a;cursor:pointer;}
</style>
</head>
<body>

<div class="topbar">SuperNFT Admin Dashboard</div>

<table id="usersTable">
  <thead>
    <tr>
      <th>Email</th>
      <th>Wallet Balance</th>
      <th>Total Deposit</th>
      <th>Live Earnings</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script type="module">
import { auth, db } from './firebase.js';
import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { collection, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// LOGIN GUARD
onAuthStateChanged(auth,user=>{
  if(!user) location.replace("admin-login.html");
});

// FETCH USERS
async function loadUsers(){
  const snapshot = await getDocs(collection(db,"users"));
  const tbody = document.querySelector("#usersTable tbody");
  tbody.innerHTML="";
  snapshot.forEach(docSnap=>{
    const u = docSnap.data();
    tbody.innerHTML += `<tr>
      <td>${u.email}</td>
      <td>$${u.walletBalance || 0}</td>
      <td>$${u.totalDeposit || 0}</td>
      <td>$${u.liveEarnings || 0}</td>
      <td><button onclick="editWallet('${docSnap.id}')">Edit Wallet</button></td>
    </tr>`;
  });
}

async function editWallet(uid){
  const newBal = prompt("Enter new wallet balance:");
  if(newBal !== null){
    await updateDoc(doc(db,"users",uid),{walletBalance: Number(newBal)});
    alert("Wallet updated âœ…");
    loadUsers();
  }
}

loadUsers();
</script>

</body>
</html>
