<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SuperNFT Dashboard</title>
<style>
*{box-sizing:border-box;}
body{margin:0;font-family:Arial,sans-serif;background:#0b0f1a;color:#fff;overflow-x:hidden;}
.topbar{position:fixed;top:0;left:0;width:100%;height:60px;background:#111827;display:flex;align-items:center;padding:0 20px;z-index:1001;}
.topbar h1{margin:0;font-size:18px;}
.hamburger{font-size:24px;cursor:pointer;margin-right:15px;}
.sidebar{position:fixed;top:60px;left:-260px;width:260px;height:calc(100vh-60px);background:#111827;padding:15px;transition:.3s;overflow-y:auto;z-index:1000;}
.sidebar.show{left:0;}
.sidebar ul{list-style:none;padding:0;margin:0;}
.sidebar li{margin:10px 0;}
.sidebar a{display:block;padding:10px;color:#fff;text-decoration:none;border-radius:6px;}
.sidebar a:hover{background:#38bdf8;color:#000;}
.main{margin-top:60px;padding:15px;transition:.3s;}
.main.shift{margin-left:260px;}
.categories{display:flex;gap:10px;margin-bottom:15px;flex-wrap:wrap;}
.categories button{padding:8px 14px;border:none;border-radius:20px;background:#1f2937;color:#fff;cursor:pointer;}
.categories button.active,.categories button:hover{background:#38bdf8;color:#000;}
.nft-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:15px;}
.nft{background:#111827;border-radius:12px;padding:10px;}
.nft img{width:100%;border-radius:10px;}
.nft p{font-size:13px;margin:4px 0;}
.nft button{width:100%;margin-top:8px;padding:8px;border:none;border-radius:6px;background:#38bdf8;font-weight:bold;cursor:pointer;}
.balance-card{background:#111827;padding:10px;border-radius:10px;margin-bottom:15px;font-weight:bold;text-align:center;}
@media(max-width:600px){.main.shift{margin-left:0}.nft-grid{grid-template-columns:1fr;}}
</style>
</head>
<body>

<!-- TOP -->
<div class="topbar">
  <span class="hamburger" id="menuBtn">&#9776;</span>
  <h1>SuperNFT Dashboard</h1>
</div>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
<ul>
<li><a href="dashboard.html">Dashboard</a></li>
<li><a href="account.html">Account</a></li>
<li><a href="my-investments.html">My Investments</a></li>
<li><a href="my-team.html">My Team</a></li>
<li><a href="my-level.html">My Level</a></li>
<li><a href="deposit.html">Deposit</a></li>
<li><a href="withdraw.html">Withdraw</a></li>
<li><a href="claim.html">Claim</a></li>
<li><a href="calculator.html">Calculator</a></li>
<li><a href="daily.html">Daily Earnings</a></li>
<li><a href="settings.html">Settings</a></li>
<li><a href="login.html" id="logoutBtn">Logout</a></li>
</ul>
</div>

<!-- MAIN -->
<div class="main" id="main">

<div class="balance-card" id="liveBalance">Loading balance...</div>

<div id="refBox" style="background:#111827;padding:12px;border-radius:10px;margin-bottom:15px;">
<b>My Referral Code:</b> <span id="myCode">Loading...</span>
</div>
<button id="copyBtn" style="margin-left:10px;padding:5px 10px;border:none;border-radius:6px;background:#38bdf8;color:#0b0f1a;cursor:pointer;font-weight:bold;">Copy</button>
<button id="shareBtn" style="margin-left:10px;padding:5px 10px;border:none;border-radius:6px;background:#10b981;color:#0b0f1a;cursor:pointer;font-weight:bold;">Share</button>

<div class="categories">
<button onclick="filterNFT('all')" class="active">All</button>
<button onclick="filterNFT('starter')">Starter</button>
<button onclick="filterNFT('rising')">Rising</button>
<button onclick="filterNFT('elite')">Elite</button>
<button onclick="filterNFT('legendary')">Legendary</button>
</div>

<div class="nft-grid" id="nfts"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, getDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyB4SGtNZL0N4TIoJ1bGbkiAeRWJcQgrF-4",
authDomain: "supernft-5b952.firebaseapp.com",
projectId: "supernft-5b952",
storageBucket: "supernft-5b952.appspot.com",
messagingSenderId: "278097730700",
appId: "1:278097730700:web:6ba9892334456fd8512fa9"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ðŸ” Login guard
onAuthStateChanged(auth, async user=>{
  if(!user) return window.location.replace("login.html");
  const userRef = doc(db,"users",user.uid);
  const snap = await getDoc(userRef);
  if(!snap.exists()){
    await updateDoc(userRef,{deposits:[],withdrawals:[],nfts:[],myReferralCode:"REF"+Math.floor(Math.random()*100000)});
  }
  loadUserData(user.uid);
});

// Sidebar toggle
const menuBtn=document.getElementById("menuBtn");
const sidebar=document.getElementById("sidebar");
const main=document.getElementById("main");
menuBtn.onclick=()=>{sidebar.classList.toggle("show");main.classList.toggle("shift");};

// NFT DATA
const NFTS=[
{cat:"starter",price:10,p:0.2,img:"images/IMG_0458.png"},
{cat:"starter",price:15,p:0.3,img:"images/IMG_0459.png"},
{cat:"starter",price:20,p:0.4,img:"images/IMG_0460.png"},
{cat:"starter",price:25,p:0.5,img:"images/IMG_0461.png"},
{cat:"starter",price:30,p:0.6,img:"images/IMG_0462.png"},
{cat:"starter",price:35,p:0.7,img:"images/IMG_0463.png"},
{cat:"starter",price:40,p:0.8,img:"images/IMG_0464.png"},
{cat:"starter",price:45,p:0.9,img:"images/IMG_0465.png"},
{cat:"starter",price:50,p:1,img:"images/IMG_0466.png"},
{cat:"rising",price:55,p:1.3,img:"images/IMG_0467.png"},
{cat:"rising",price:60,p:1.5,img:"images/IMG_0468.png"},
{cat:"rising",price:65,p:1.63,img:"images/IMG_0469.png"},
{cat:"rising",price:70,p:1.75,img:"images/IMG_0470.png"},
{cat:"rising",price:75,p:1.88,img:"images/IMG_0471.png"},
{cat:"rising",price:80,p:2,img:"images/IMG_0472.png"},
{cat:"rising",price:90,p:2.25,img:"images/IMG_0473.png"},
{cat:"rising",price:100,p:2.5,img:"images/IMG_0474.png"},
{cat:"elite",price:150,p:5,img:"images/IMG_0475.png"},
{cat:"elite",price:200,p:6.6,img:"images/IMG_0476.png"},
{cat:"elite",price:250,p:8.25,img:"images/IMG_0477.png"},
{cat:"elite",price:300,p:10,img:"images/IMG_0478.png"},
{cat:"elite",price:350,p:11.6,img:"images/IMG_0479.png"},
{cat:"elite",price:400,p:13.3,img:"images/IMG_0480.png"},
{cat:"elite",price:450,p:15,img:"images/IMG_0481.png"},
{cat:"legendary",price:499,p:25,img:"images/IMG_0482.png"},
{cat:"legendary",price:599,p:30,img:"images/IMG_0483.png"},
{cat:"legendary",price:699,p:40,img:"images/IMG_0497.png"},
{cat:"legendary",price:799,p:30,img:"images/IMG_0498.png"},
{cat:"legendary",price:899,p:45,img:"images/IMG_0499.png"},
{cat:"legendary",price:999,p:100,img:"images/IMG_0503.png"}
];

const box=document.getElementById("nfts");

function render(list){
 box.innerHTML="";
 list.forEach(n=>{
  box.innerHTML+=`
  <div class="nft">
   <img src="${n.img}">
   <p>Price $${n.price}</p>
   <p>Daily Income $${n.p}</p>
   <p>Validity 365 Days</p>
   <button onclick="buyNFT(${n.price},'${n.cat}',${n.p})">Buy NFT</button>
  </div>`;
 });
}
render(NFTS);

function filterNFT(c){
 document.querySelectorAll(".categories button").forEach(b=>b.classList.remove("active"));
 event.target.classList.add("active");
 if(c==="all") render(NFTS);
 else render(NFTS.filter(n=>n.cat===c));
}

// Buy NFT
async function buyNFT(price,cat,dailyPercent){
 const user = auth.currentUser;
 if(!user) return;
 const userRef = doc(db,"users",user.uid);
 const snap = await getDoc(userRef);
 const data = snap.data();
 const deposits = data.deposits || [];
 const withdrawals = data.withdrawals || [];
 const balance = deposits.reduce((s,d)=>s+d.amount,0)-withdrawals.reduce((s,w)=>s+w.amount,0);

 if(balance<price) return alert("Insufficient balance to buy NFT");

 await updateDoc(userRef,{nfts: arrayUnion({
  price: price,
  cat: cat,
  dailyPercent: dailyPercent,
  boughtAt: new Date()
 })});
alert("NFT purchased âœ…");
loadUserData(user.uid);
}

// Load user data (live balance + live earnings + referral)
async function loadUserData(uid){
 const snap = await getDoc(doc(db,"users",uid));
 if(!snap.exists()) return;
 const data = snap.data();
 // Referral code
document.getElementById("myCode").innerText = data.myReferralCode;
updateLiveBalanceAndEarnings(data);
}

// Copy & share referral
document.getElementById("copyBtn").addEventListener("click", ()=>{
navigator.clipboard.writeText(document.getElementById("myCode").innerText).then(()=>alert("Referral code copied âœ…"));
});
document.getElementById("shareBtn").addEventListener("click", ()=>{
const text=`Join SuperNFT with my referral code: ${document.getElementById("myCode").innerText}`;
window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(text)}`,"_blank");
});

// Live balance + earnings
function updateLiveBalanceAndEarnings(data){
 const deposits = data.deposits||[];
 const withdrawals = data.withdrawals||[];
 const nfts = data.nfts||[];
 const depositTotal = deposits.reduce((s,d)=>s+d.amount,0);
 const withdrawnTotal = withdrawals.reduce((s,w)=>s+w.amount,0);
 const nftEarnings = nfts.reduce((sum,n)=>{
   const daysPassed = Math.floor((Date.now() - n.boughtAt.toDate().getTime())/(1000*60*60*24));
   return sum + n.price*(n.dailyPercent/100)*daysPassed;
 },0);
 document.getElementById("liveBalance").innerText = `Balance: ${(depositTotal - withdrawnTotal + nftEarnings).toFixed(2)} BSC`;
}

// Logout
document.getElementById("logoutBtn").addEventListener("click",()=>{signOut(auth).then(()=>window.location.replace("login.html"))});
</script>

</body>
</html>
